name: Validate Pull Request

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]
    branches:
      - main

jobs:
  validate-pr:
    name: Validate Pull Request
    runs-on: ubuntu-latest
    steps:
      - name: Check PR Title
        run: |
          title="${{ github.event.pull_request.title }}"
          title_regex="^(feat|chore|fix|test|docs|refactor|style|perf|revert):"
          if [[ ! "$title" =~ $title_regex ]]; then
            echo "❌ PR title must start with a valid prefix (e.g., feat, chore, fix, test, etc.) followed by a colon."
            exit 1
          fi
          echo "✅ PR title is valid."

      - name: Check Branch Name
        run: |
          branch="${{ github.event.pull_request.head.ref }}"
          branch_regex="^(feat|chore|fix|test|docs|refactor|style|perf|revert)/[a-z0-9-]+$"
          if [[ ! "$branch" =~ $branch_regex ]]; then
            echo "❌ Branch name must start with a valid prefix (e.g., feat/, chore/, fix/, etc.) followed by a descriptive name."
            exit 1
          fi
          echo "✅ Branch name is valid."
      
      - name: Check PR Description
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          MIN_WORDS=10
          count=$(echo "$PR_BODY" | wc -w)
          if [ "$count" -lt "$MIN_WORDS" ]; then
            echo "❌ PR description is too short ($count words). Please provide a more detailed description (at least $MIN_WORDS words)."
            exit 1
          fi
          echo "✅ PR description is valid."